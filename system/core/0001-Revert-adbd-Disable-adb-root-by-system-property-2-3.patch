From 34dba70dbef8c41eebae865e9a006203715c5f3a Mon Sep 17 00:00:00 2001
From: Andreas Blaesius <skate4life@gmx.de>
Date: Sat, 25 Nov 2017 19:54:05 +0100
Subject: [PATCH] Revert "adbd: Disable "adb root" by system property (2/3)"

This reverts commit 4911b6a137681cc5a021900bfcfcd10ec6944abe.

Change-Id: Ic4a8543ba34bb9c36e33eb44134c2d8b32f38961
---
 adb/services.c | 13 -------------
 1 file changed, 13 deletions(-)

diff --git a/adb/services.c b/adb/services.c
index 119da85..da73ce8 100644
--- a/adb/services.c
+++ b/adb/services.c
@@ -61,8 +61,6 @@ void restart_root_service(int fd, void *cookie)
 {
     char buf[100];
     char value[PROPERTY_VALUE_MAX];
-    char build_type[PROPERTY_VALUE_MAX];
-    char cm_version[PROPERTY_VALUE_MAX];
 
     if (getuid() == 0) {
         snprintf(buf, sizeof(buf), "adbd is already running as root\n");
@@ -77,17 +75,6 @@ void restart_root_service(int fd, void *cookie)
             return;
         }
 
-        property_get("persist.sys.root_access", value, "1");
-        property_get("ro.build.type", build_type, "");
-        property_get("ro.cm.version", cm_version, "");
-
-        if (strlen(cm_version) > 0 && strcmp(build_type, "eng") != 0 && (atoi(value) & 2) != 2) {
-            snprintf(buf, sizeof(buf), "root access is disabled by system setting - enable in settings -> development options\n");
-            writex(fd, buf, strlen(buf));
-            adb_close(fd);
-            return;
-        }
-
         property_set("service.adb.root", "1");
         snprintf(buf, sizeof(buf), "restarting adbd as root\n");
         writex(fd, buf, strlen(buf));
-- 
2.7.4

