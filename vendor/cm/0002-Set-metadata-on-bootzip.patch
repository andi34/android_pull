From a64720a6f948c18c019674fb5a2bef00856bdd0b Mon Sep 17 00:00:00 2001
From: Andreas Blaesius <skate4life@gmx.de>
Date: Tue, 11 Aug 2015 16:50:52 +0200
Subject: [PATCH 2/3] Set metadata on bootzip

Change-Id: I54cf171f0b2e46ece98fa89ce2a3972bf7a5127d
---
 build/tools/releasetools/boot_flash_from_image | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/build/tools/releasetools/boot_flash_from_image b/build/tools/releasetools/boot_flash_from_image
index 164188f..dc9852c 100755
--- a/build/tools/releasetools/boot_flash_from_image
+++ b/build/tools/releasetools/boot_flash_from_image
@@ -100,6 +100,8 @@ elif boot_partition_type == "bml":
     contents += "\tdelete(\"/tmp/boot.img\"));\n"
 contents += "mount(\"%s\", \"EMMC\", \"%s\", \"system\");\n" % (system_partition_type, system_partition)
 contents += "package_extract_dir(\"system\", \"/system\");\n"
+contents += "ui_print(\"Setting permissions...\");\n"
+contents += "set_metadata_recursive(\"/system/lib/modules\", \"uid\", 0, \"gid\", 0, \"dmode\", 0755, \"fmode\",0644, \"capabilities\", 0x0, \"selabel\", \"u:object_r:system_file:s0\");\n"
 contents += "unmount(\"/system\");\n"
 contents += "ui_print(\" \");\n"
 contents += "ui_print(\"Done!\");"
-- 
2.7.4

