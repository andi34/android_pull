From 0760c3dc877fd234123219996469e9147367b624 Mon Sep 17 00:00:00 2001
From: Ziyan <jaraidaniel@gmail.com>
Date: Thu, 8 Sep 2016 14:44:15 +0200
Subject: [PATCH 2/2] Add board file flag for glReadPixels screenshot path

Backported from N:
https://github.com/OMAP4-AOSP/android_frameworks_native/commit/7cc6220f75ddb4d5cfede30ac1d945a136e4634e

This kills the need for a global cflag. Device must set:
TARGET_FORCE_SCREENSHOT_CPU_PATH := true

Change-Id: I72976313cd821d7aeff0b0fd0107a9f7c80b5c7e
---
 libs/gui/Android.mk                | 4 ++++
 services/surfaceflinger/Android.mk | 3 +++
 2 files changed, 7 insertions(+)

diff --git a/libs/gui/Android.mk b/libs/gui/Android.mk
index e3557d473..8189e51e7 100644
--- a/libs/gui/Android.mk
+++ b/libs/gui/Android.mk
@@ -51,6 +51,10 @@ endif
     LOCAL_CFLAGS += -DQCOM_BSP
 endif
 
+ifeq ($(TARGET_FORCE_SCREENSHOT_CPU_PATH), true)
+	LOCAL_CFLAGS += -DFORCE_SCREENSHOT_CPU_PATH
+endif
+
 ifeq ($(BOARD_EGL_SKIP_FIRST_DEQUEUE),true)
     LOCAL_CFLAGS += -DSURFACE_SKIP_FIRST_DEQUEUE
 endif
diff --git a/services/surfaceflinger/Android.mk b/services/surfaceflinger/Android.mk
index 0166b891c..4847a492c 100644
--- a/services/surfaceflinger/Android.mk
+++ b/services/surfaceflinger/Android.mk
@@ -37,6 +37,9 @@ LOCAL_SRC_FILES:= \
 LOCAL_CFLAGS:= -DLOG_TAG=\"SurfaceFlinger\"
 LOCAL_CFLAGS += -DGL_GLEXT_PROTOTYPES -DEGL_EGLEXT_PROTOTYPES
 
+ifeq ($(TARGET_FORCE_SCREENSHOT_CPU_PATH),true)
+    LOCAL_CFLAGS += -DFORCE_SCREENSHOT_CPU_PATH
+endif
 ifeq ($(TARGET_BOARD_PLATFORM),omap4)
 	LOCAL_CFLAGS += -DHAS_CONTEXT_PRIORITY
 endif
-- 
2.17.1

