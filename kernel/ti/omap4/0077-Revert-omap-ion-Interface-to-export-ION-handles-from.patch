From a5496bf078ee4c70094c46f1340bd0946ba12189 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?D=2E=20Andrei=20M=C4=83ce=C8=99?= <dmaces@nd.edu>
Date: Tue, 24 Nov 2015 15:36:42 -0500
Subject: [PATCH 077/102] Revert "omap-ion: Interface to export ION handles
 from PVR fd"
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

This reverts commit 857784c7d92bdb3197504f947597010adc1661f5.

Change-Id: I3a616bdd1fa4b659aacd1f35cc9a6506819ec4cc
Signed-off-by: D. Andrei Măceș <dmaces@nd.edu>
---
 drivers/gpu/ion/omap/omap_ion.c | 48 -----------------------------------------
 include/linux/omap_ion.h        |  3 ---
 2 files changed, 51 deletions(-)

diff --git a/drivers/gpu/ion/omap/omap_ion.c b/drivers/gpu/ion/omap/omap_ion.c
index 57f39d1..8d08ece 100644
--- a/drivers/gpu/ion/omap/omap_ion.c
+++ b/drivers/gpu/ion/omap/omap_ion.c
@@ -22,9 +22,6 @@
 #include <linux/uaccess.h>
 #include "../ion_priv.h"
 #include "omap_ion_priv.h"
-#ifdef CONFIG_PVR_SGX
-#include "../gpu/pvr/ion.h"
-#endif
 
 struct ion_device *omap_ion_device;
 EXPORT_SYMBOL(omap_ion_device);
@@ -152,51 +149,6 @@ int omap_ion_remove(struct platform_device *pdev)
 	return 0;
 }
 
-static void (*export_fd_to_ion_handles)(int fd,
-		struct ion_client **client,
-		struct ion_handle **handles,
-		int *num_handles);
-void omap_ion_register_pvr_export(void *pvr_export_fd)
-{
-	export_fd_to_ion_handles = pvr_export_fd;
-}
-EXPORT_SYMBOL(omap_ion_register_pvr_export);
-
-int omap_ion_fd_to_handles(int fd, struct ion_client **client,
-		struct ion_handle **handles,
-		int *num_handles)
-{
-	struct ion_buffer *ionbuff;
-	int i;
-#ifdef CONFIG_PVR_SGX
-	if (*num_handles == 2)
-		PVRSRVExportFDToIONHandles(fd, client, handles);
-	else if (*num_handles == 1)
-		handles[0] = PVRSRVExportFDToIONHandle(fd, client);
-	else
-		return -EINVAL;
-#else
-	if (export_fd_to_ion_handles) {
-		export_fd_to_ion_handles(fd,
-				client,
-				handles,
-				num_handles);
-	} else {
-		pr_err("%s: export_fd_to_ion_handles"
-				"not initiazied",
-				__func__);
-		return -EINVAL;
-	}
-#endif
-	for (i = 0; i < *num_handles; i++) {
-		ionbuff = ion_share(*client, handles[i]);
-		handles[i] = ion_import(*client, ionbuff);
-	}
-
-	return 0;
-}
-
-
 static struct platform_driver ion_driver = {
 	.probe = omap_ion_probe,
 	.remove = omap_ion_remove,
diff --git a/include/linux/omap_ion.h b/include/linux/omap_ion.h
index 621c2c8..75b51fe 100644
--- a/include/linux/omap_ion.h
+++ b/include/linux/omap_ion.h
@@ -51,9 +51,6 @@ int omap_ion_nonsecure_tiler_alloc(struct ion_client *client,
 /* given a handle in the tiler, return a list of tiler pages that back it */
 int omap_tiler_pages(struct ion_client *client, struct ion_handle *handle,
 		     int *n, u32 ** tiler_pages);
-int omap_ion_fd_to_handles(int fd, struct ion_client **client,
-		struct ion_handle **handles,
-		int *num_handles);
 int omap_tiler_vinfo(struct ion_client *client,
 			struct ion_handle *handle, unsigned int *vstride,
 			unsigned int *vsize);
-- 
2.7.4

